var Pe=Object.defineProperty;var Fe=(I,e,$)=>e in I?Pe(I,e,{enumerable:!0,configurable:!0,writable:!0,value:$}):I[e]=$;var K=(I,e,$)=>(Fe(I,typeof e!="symbol"?e+"":e,$),$);import{K as k,d as ae,r as le,t as Ae,o as ue,a as b,b as A,c as M,e as o,w as y,f as t,g as J,u as a,E as H,F as te,h as se,i as j,j as Ce,k as re,l as Ge,m as We,n as ce,p as Ne,q as Ye,v as je}from"./index-2785f950.js";const r={CANVAS:"canvas",NORMAL:"normal",CIRCLE:"circle",LINE:"line",TRIANGLE:"triangle"},Be=[{name:"鼠标",icon:"icon-jiantou_zuoshang",type:r.NORMAL},{name:"汇接点",icon:"icon-diandian",type:r.CIRCLE},{name:"管渠",icon:"icon-map-connect-full",type:r.LINE},{name:"排水口",icon:"icon-sanjiaoxing",type:r.TRIANGLE}],Je=[{name:"一月",value:"1.0"},{name:"二月",value:"1.0"},{name:"三月",value:"1.0"},{name:"四月",value:"1.0"},{name:"五月",value:"1.0"},{name:"六月",value:"1.0"},{name:"七月",value:"1.0"},{name:"八月",value:"1.0"},{name:"九月",value:"1.0"},{name:"十月",value:"1.0"},{name:"十一月",value:"1.0"},{name:"十二月",value:"1.0"}],Xe=[{name:"星期一",value:"1.0"},{name:"星期二",value:"1.0"},{name:"星期三",value:"1.0"},{name:"星期四",value:"1.0"},{name:"星期五",value:"1.0"},{name:"星期六",value:"1.0"},{name:"星期日",value:"1.0"}],He=[{name:"1AM",value:"1.0"},{name:"2AM",value:"1.0"},{name:"3AM",value:"1.0"},{name:"4AM",value:"1.0"},{name:"5AM",value:"1.0"},{name:"6AM",value:"1.0"},{name:"7AM",value:"1.0"},{name:"8AM",value:"1.0"},{name:"9AM",value:"1.0"},{name:"10AM",value:"1.0"},{name:"11AM",value:"1.0"},{name:"12AM",value:"1.0"},{name:"1PM",value:"1.0"},{name:"2PM",value:"1.0"},{name:"3PM",value:"1.0"},{name:"4PM",value:"1.0"},{name:"5PM",value:"1.0"},{name:"6PM",value:"1.0"},{name:"7PM",value:"1.0"},{name:"8PM",value:"1.0"},{name:"9PM",value:"1.0"},{name:"10PM",value:"1.0"},{name:"11PM",value:"1.0"},{name:"12PM",value:"1.0"}];class Ke{constructor(e){K(this,"id");K(this,"SCALE_BY");K(this,"stage");K(this,"layer");K(this,"tr");K(this,"group");this.id=e,this.SCALE_BY=1.1,this.stage=void 0,this.layer=this.newLayer(),this.tr=this.newTransformer(),this.group=this.newGroup({x:0,y:0}),this.init()}init(){const e=document.getElementById(this.id);if(!e)return;const{clientWidth:$,clientHeight:n}=e;this.stage=this.newStage({container:this.id,width:$,height:n,draggable:!1,type:r.CANVAS}),this.layer.add(this.group),this.layer.add(this.tr),this.stage.add(this.layer),this.addListenerStageEvents()}addListenerStageEvents(){const{stage:e}=this;e&&e.on("wheel",$=>{if(!e)return;const n=e.scaleX(),s=e.getPointerPosition(),f={x:(s.x-e.x())/n,y:(s.y-e.y())/n};let R=$.evt.deltaY>0?-1:1;$.evt.ctrlKey&&(R=-R);const l=R>0?n*this.SCALE_BY:n/this.SCALE_BY;e.scale({x:l,y:l});const D={x:s.x-f.x*l,y:s.y-f.y*l};e.position(D)})}drawBoard(){if(!this.stage)return;const e=800,$=500,n=this.stage.width()/2-e/2,s=this.stage.height()/2-$/2,f=this.newRect({id:this.getUUID(),title:"画板",name:"board",x:n,y:s,width:e,height:$,fill:"#ffffff",type:r.BOARD,stroke:"#ffffff",strokeWidth:1,opacity:1,create:!0,scaleX:1,scaleY:1});this.group.add(f)}drawShapes(e,$){if(!this.stage)return;let n;const s=this.getUUID();if(e===r.RECT){const f=this.stage.find(".rect");n=this.newRect({id:s,title:`矩形${f.length+1}`,name:"rect",width:200,height:100,fill:"#ffffff",stroke:"#000000",strokeWidth:1,draggable:!0,type:e,opacity:1,create:!0,scaleX:1,scaleY:1})}else if(e===r.PARALLELOGRAM){const f=this.stage.find(".parallelogram");n=this.newRect({id:s,title:`平行四边形${f.length+1}`,name:"parallelogram",width:200,height:100,fill:"#ffffff",stroke:"#000000",strokeWidth:1,draggable:!0,skewX:-.5,type:e,opacity:1,create:!0,scaleX:1,scaleY:1})}else if(e===r.RHOMBUS){const f=this.stage.find(".rhombus");n=new k.RegularPolygon({id:s,title:`菱形${f.length+1}`,sides:4,radius:100,name:"rhombus",fill:"#ffffff",stroke:"#000000",strokeWidth:1,draggable:!0,type:e,opacity:1,create:!0,scaleX:1,scaleY:1})}else if(e===r.CIRCLE){const f=this.stage.find(".circle");n=new k.Circle({id:s,title:`汇接点${f.length+1}`,radius:10,name:"circle",fill:"#000000",stroke:"#000000",strokeWidth:1,draggable:!1,type:e,opacity:1,create:!1,scaleX:1,scaleY:1})}else if(e===r.TRIANGLE){const f=this.stage.find(".triangle");n=new k.RegularPolygon({id:s,x:0,y:0,title:`排水口${f.length+1}`,rotation:180,sides:3,radius:12,name:"triangle",fill:"#000000",stroke:"#000000",strokeWidth:1,type:e,draggable:!1})}if(n)return n.position($),this.group.add(n),n.moveToTop(),n}drawLine(e,$,n,s){if(!this.stage)return;const f=this.getUUID(),R=this.stage.find(".line"),l=new k.Line({id:f,title:`管渠${R.length+1}`,points:[e,$,n,s],stroke:"black",name:"line",type:r.LINE,opacity:1,strokeWidth:5,draggable:!1});return this.group.add(l),l.moveToBottom(),l}onresize(){var s;const e=document.getElementById(this.id);if(!e)return;const{clientWidth:$,clientHeight:n}=e;(s=this.stage)==null||s.setAttrs({width:$,height:n})}getUUID(){let e=Date.now();return typeof performance<"u"&&typeof performance.now=="function"&&(e+=performance.now()),"xxxxxxxxxxxxxxx4xxxyxxxxxxxxxxxxxx".replace(/[xy]/g,function($){const n=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),($==="x"?n:n&3|8).toString(16)})}newStage(e){return new k.Stage(e)}newLayer(){return new k.Layer}newTransformer(){return new k.Transformer({rotateEnabled:!1})}newGroup(e){return new k.Group(e)}newRect(e){return new k.Rect(e)}newCircle(e){return new k.Circle(e)}newText(e){return new k.Text(e)}newRegularPolygon(e){return new k.RegularPolygon(e)}newLine(e){return new k.Line(e)}newLabel(e){return new k.Label(e)}newTag(e){return new k.Tag(e)}newArrows(e){return new k.Arrow(e)}newPath(e){return new k.Path(e)}}const qe={class:"timeSeriesDia"},ze={class:"threeShowDiv"},Qe={class:"common-layout"},Ze={class:"content"},et={class:"dialog-footer"},Te=ae({__name:"timeSeriesDia",props:{details:{type:Object,required:!0}},emits:["close","save"],setup(I,{emit:e}){const $=I,n=le({formData:{},diaVis:!0}),{formData:s}=Ae(n);ue(()=>{n.formData=JSON.parse(JSON.stringify($.details)),n.formData.datas.length===0&&n.formData.datas.push({date:"",time:"",value:""})});const f=V=>{n.formData.datas.splice(V+1,0,{date:"",time:"",value:""})},R=V=>{if(n.formData.datas.length<=1){H.warning("不能再删除了");return}n.formData.datas.splice(V,1)},l=()=>{e("close")},D=()=>{if(n.formData.name===""){H.warning("请输入名称");return}if(n.formData.datas.length===0){H.warning("请输入时间序列");return}for(let V=0;V<n.formData.datas.length;V++){let x=n.formData.datas[V];if(x.date===""){H.warning(`请输入第[${V+1}]行日期`);return}if(x.time===""){H.warning(`请输入第[${V+1}]行时间`);return}if(x.value===""){H.warning(`请输入第[${V+1}]行数值`);return}}e("save",n.formData)};return(V,x)=>{const i=b("el-input"),C=b("el-form-item"),p=b("el-form"),S=b("el-aside"),P=b("el-table-column"),v=b("el-button"),X=b("el-table"),E=b("el-main"),oe=b("el-container"),ne=b("el-dialog");return A(),M("div",qe,[o(ne,{modelValue:n.diaVis,"onUpdate:modelValue":x[2]||(x[2]=u=>n.diaVis=u),title:"时间序列配置","close-on-click-modal":!1,width:"1000px","before-close":l},{footer:y(()=>[t("span",et,[o(v,{onClick:l},{default:y(()=>[J("取消")]),_:1}),o(v,{type:"primary",onClick:D},{default:y(()=>[J("确定")]),_:1})])]),default:y(()=>[t("div",ze,[t("div",Qe,[o(oe,null,{default:y(()=>[o(S,{width:"300px",style:{"margin-top":"60px"}},{default:y(()=>[o(p,{model:a(s),class:"demo-form-inline","label-position":"right","label-width":"100px"},{default:y(()=>[o(C,{label:"时间序列名"},{default:y(()=>[o(i,{modelValue:a(s).name,"onUpdate:modelValue":x[0]||(x[0]=u=>a(s).name=u),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),o(C,{label:"描述"},{default:y(()=>[o(i,{modelValue:a(s).description,"onUpdate:modelValue":x[1]||(x[1]=u=>a(s).description=u),type:"textarea",rows:6,placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),o(E,{style:{}},{default:y(()=>[t("div",Ze,[o(X,{data:a(s).datas,style:{width:"100%",overflow:"hidden"},height:"400",border:""},{default:y(()=>[o(P,{prop:"name",label:"日期(月/日/年)",align:"center"},{default:y(u=>[o(i,{modelValue:u.row.date,"onUpdate:modelValue":Y=>u.row.date=Y,placeholder:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(P,{label:"时间(时:分)",align:"center"},{default:y(u=>[o(i,{modelValue:u.row.time,"onUpdate:modelValue":Y=>u.row.time=Y,placeholder:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(P,{label:"数值",align:"center"},{default:y(u=>[o(i,{modelValue:u.row.value,"onUpdate:modelValue":Y=>u.row.value=Y,placeholder:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(P,{label:"操作",align:"center"},{default:y(u=>[o(v,{size:"small",type:"primary",onClick:Y=>f(u.$index)},{default:y(()=>[J(" 新增")]),_:2},1032,["onClick"]),o(v,{size:"small",type:"danger",onClick:Y=>R(u.$index)},{default:y(()=>[J("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1})])])]),_:1},8,["modelValue"])])}}}),tt={class:"patternDia"},st={class:"threeShowDiv"},at={class:"common-layout"},lt={class:"content"},ot={class:"dialog-footer"},Re=ae({__name:"patternDia",props:{details:{type:Object,required:!0}},emits:["close","save"],setup(I,{emit:e}){const $=I,n=le({dateDatas:[{label:"月",value:"month"},{label:"周",value:"week"},{label:"日",value:"hours"}],formData:{},diaVis:!0}),{formData:s}=Ae(n);ue(()=>{n.formData=JSON.parse(JSON.stringify($.details)),R(n.formData.type)});const f=()=>{e("close")},R=V=>{n.formData.datas.length===0&&(V==="month"?n.formData.datas=Je:V==="week"?n.formData.datas=Xe:V==="hours"?n.formData.datas=He:n.formData.datas=[])},l=V=>{n.formData.datas=[],R(V)},D=()=>{if(n.formData.name===""){H.warning("请输入名称");return}for(let V=0;V<n.formData.datas.length;V++)if(n.formData.datas[V].value===""){H.warning(`请输入第[${V+1}]行数值`);return}e("save",n.formData)};return(V,x)=>{const i=b("el-input"),C=b("el-form-item"),p=b("el-option"),S=b("el-select"),P=b("el-form"),v=b("el-aside"),X=b("el-table-column"),E=b("el-table"),oe=b("el-main"),ne=b("el-container"),u=b("el-button"),Y=b("el-dialog");return A(),M("div",tt,[o(Y,{modelValue:n.diaVis,"onUpdate:modelValue":x[3]||(x[3]=T=>n.diaVis=T),title:"时间模式编辑器","close-on-click-modal":!1,width:"1000px","before-close":f},{footer:y(()=>[t("span",ot,[o(u,{onClick:f},{default:y(()=>[J("取消")]),_:1}),o(u,{type:"primary",onClick:D},{default:y(()=>[J("确定")]),_:1})])]),default:y(()=>[t("div",st,[t("div",at,[o(ne,null,{default:y(()=>[o(v,{width:"400px",style:{"margin-top":"60px"}},{default:y(()=>[o(P,{model:a(s),class:"demo-form-inline","label-position":"right","label-width":"100px"},{default:y(()=>[o(C,{label:"名称"},{default:y(()=>[o(i,{modelValue:a(s).name,"onUpdate:modelValue":x[0]||(x[0]=T=>a(s).name=T),style:{width:"240px"},placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),o(C,{label:"类型"},{default:y(()=>[o(S,{modelValue:a(s).type,"onUpdate:modelValue":x[1]||(x[1]=T=>a(s).type=T),placeholder:"",style:{width:"240px"},onChange:l},{default:y(()=>[(A(!0),M(te,null,se(n.dateDatas,T=>(A(),j(p,{key:T.value,label:T.label,value:T.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(C,{label:"描述"},{default:y(()=>[o(i,{modelValue:a(s).description,"onUpdate:modelValue":x[2]||(x[2]=T=>a(s).description=T),type:"textarea",rows:6,style:{width:"240px"},placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),o(oe,{style:{}},{default:y(()=>[t("div",lt,[o(E,{data:n.formData.datas,style:{width:"100%"},height:"400",border:""},{default:y(()=>[o(X,{prop:"name",label:"Name",align:"center"},{default:y(T=>[o(i,{modelValue:T.row.name,"onUpdate:modelValue":ie=>T.row.name=ie,placeholder:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(X,{label:"Value",align:"center"},{default:y(T=>[o(i,{modelValue:T.row.value,"onUpdate:modelValue":ie=>T.row.value=ie,placeholder:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1})])])]),_:1},8,["modelValue"])])}}}),nt={class:"attrs"},it={class:"attrs-content"},dt=t("div",{class:"attrs-title"},"基本配置",-1),rt={class:"attrs-item"},ut=t("div",{class:"label"},"名称",-1),ct={class:"input"},pt={class:"attrs-item"},mt=t("div",{class:"label"},"标签",-1),_t={class:"input"},ht={class:"attrs-item"},ft=t("div",{class:"label"},"X",-1),vt={class:"input"},gt={class:"attrs-item"},yt=t("div",{class:"label"},"Y",-1),Vt={class:"input"},$t={class:"attrs-item"},Dt=t("div",{class:"label"},"内底标高",-1),xt={class:"input"},St={class:"attrs-item"},wt=t("div",{class:"label"},"最大深度",-1),bt={class:"input"},Et={class:"attrs-item"},Nt=t("div",{class:"label"},"初始深度",-1),At={class:"input"},Ct={class:"attrs-item"},Lt=t("div",{class:"label"},"超载深度",-1),Tt={class:"input"},Rt={class:"attrs-item"},It=t("div",{class:"label"},"积水面积",-1),Ot={class:"input"},kt={class:"attrs-item"},Ut=t("div",{class:"label"},"描述",-1),Mt={class:"input"},Pt={class:"attrs-item"},Ft=t("div",{class:"label"},"进流量",-1),Gt={class:"input"},Wt=t("div",{class:"attrs-title"},"进流量配置",-1),Yt={class:"attrs-item"},jt=t("div",{class:"label"},"类型",-1),Bt={class:"input"},Jt={class:"attrs-item"},Xt=t("div",{class:"label"},"时间序列",-1),Ht={class:"input"},Kt=t("i",{class:"iconfont icon-gengduo"},null,-1),qt=[Kt],zt={class:"attrs-item"},Qt=t("div",{class:"label"},"基准线模式",-1),Zt={class:"input"},es=t("i",{class:"iconfont icon-gengduo"},null,-1),ts=[es],ss={class:"attrs-item"},as=t("div",{class:"label"},"类型[Type]",-1),ls={class:"input"},os={class:"attrs-item"},ns=t("div",{class:"label"},"乘法因子",-1),is={class:"input"},ds={class:"attrs-item"},rs=t("div",{class:"label"},"比例因子",-1),us={class:"input"},cs={class:"attrs-item"},ps=t("div",{class:"label"},"基准线",-1),ms={class:"input"},_s=ae({__name:"pointAttrs",props:{details:{type:Object,required:!0}},emits:["update:details","change"],setup(I,{emit:e}){const $=I,n=le({timeSeriesDiaVis:!1,patternDiaVis:!1}),s=Ce({get:()=>$.details,set:C=>{e("update:details",C)}});ue(()=>{s.value.constituent!==""||s.value.timeSeriesData.name!==""||s.value.mfactor!==""||s.value.sfactor!==""||s.value.baseline!==""?s.value.inflows="YES":s.value.inflows="NO"});const f=C=>{s.value.timeSeriesData=C,l(),V()},R=C=>{s.value.patternData=C,l(),i()},l=()=>{e("change")},D=()=>{n.timeSeriesDiaVis=!0},V=()=>{n.timeSeriesDiaVis=!1},x=()=>{n.patternDiaVis=!0},i=()=>{n.patternDiaVis=!1};return(C,p)=>{const S=b("el-input"),P=b("el-input-number");return A(),M("div",nt,[t("div",it,[dt,t("div",rt,[ut,t("div",ct,[o(S,{modelValue:a(s).title,"onUpdate:modelValue":p[0]||(p[0]=v=>a(s).title=v),disabled:"",style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",pt,[mt,t("div",_t,[o(S,{modelValue:a(s).tag,"onUpdate:modelValue":p[1]||(p[1]=v=>a(s).tag=v),style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",ht,[ft,t("div",vt,[o(P,{modelValue:a(s).x,"onUpdate:modelValue":p[2]||(p[2]=v=>a(s).x=v),controls:!1,onChange:l},null,8,["modelValue"])])]),t("div",gt,[yt,t("div",Vt,[o(P,{modelValue:a(s).y,"onUpdate:modelValue":p[3]||(p[3]=v=>a(s).y=v),controls:!1,onChange:l},null,8,["modelValue"])])]),t("div",$t,[Dt,t("div",xt,[o(S,{modelValue:a(s).elevation,"onUpdate:modelValue":p[4]||(p[4]=v=>a(s).elevation=v),style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",St,[wt,t("div",bt,[o(S,{modelValue:a(s).maxDepth,"onUpdate:modelValue":p[5]||(p[5]=v=>a(s).maxDepth=v),style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",Et,[Nt,t("div",At,[o(S,{modelValue:a(s).initDepth,"onUpdate:modelValue":p[6]||(p[6]=v=>a(s).initDepth=v),style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",Ct,[Lt,t("div",Tt,[o(S,{modelValue:a(s).surDepth,"onUpdate:modelValue":p[7]||(p[7]=v=>a(s).surDepth=v),style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",Rt,[It,t("div",Ot,[o(S,{modelValue:a(s).aponded,"onUpdate:modelValue":p[8]||(p[8]=v=>a(s).aponded=v),style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",kt,[Ut,t("div",Mt,[o(S,{modelValue:a(s).description,"onUpdate:modelValue":p[9]||(p[9]=v=>a(s).description=v),style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",Pt,[Ft,t("div",Gt,[o(S,{modelValue:a(s).inflows,"onUpdate:modelValue":p[10]||(p[10]=v=>a(s).inflows=v),disabled:"",style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),Wt,t("div",Yt,[jt,t("div",Bt,[o(S,{modelValue:a(s).constituent,"onUpdate:modelValue":p[11]||(p[11]=v=>a(s).constituent=v),style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",Jt,[Xt,t("div",Ht,[o(S,{modelValue:a(s).timeSeriesData.name,"onUpdate:modelValue":p[12]||(p[12]=v=>a(s).timeSeriesData.name=v),disabled:"",style:{width:"150px"},onChange:l},null,8,["modelValue"])]),t("div",{class:"btn",onClick:D},qt)]),t("div",zt,[Qt,t("div",Zt,[o(S,{modelValue:a(s).patternData.name,"onUpdate:modelValue":p[13]||(p[13]=v=>a(s).patternData.name=v),disabled:"",style:{width:"150px"},onChange:l},null,8,["modelValue"])]),t("div",{class:"btn",onClick:x},ts)]),t("div",ss,[as,t("div",ls,[o(S,{modelValue:a(s).typ,"onUpdate:modelValue":p[14]||(p[14]=v=>a(s).typ=v),style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",os,[ns,t("div",is,[o(S,{modelValue:a(s).mfactor,"onUpdate:modelValue":p[15]||(p[15]=v=>a(s).mfactor=v),style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",ds,[rs,t("div",us,[o(S,{modelValue:a(s).sfactor,"onUpdate:modelValue":p[16]||(p[16]=v=>a(s).sfactor=v),style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",cs,[ps,t("div",ms,[o(S,{modelValue:a(s).baseline,"onUpdate:modelValue":p[17]||(p[17]=v=>a(s).baseline=v),style:{width:"150px"},onChange:l},null,8,["modelValue"])])])]),n.timeSeriesDiaVis?(A(),j(Te,{key:0,details:a(s).timeSeriesData,onClose:V,onSave:f},null,8,["details"])):re("",!0),n.patternDiaVis?(A(),j(Re,{key:1,details:a(s).patternData,onClose:i,onSave:R},null,8,["details"])):re("",!0)])}}});const hs={class:"attrs"},fs={class:"attrs-content"},vs=t("div",{class:"attrs-title"},"基本配置",-1),gs={class:"attrs-item"},ys=t("div",{class:"label"},"名称",-1),Vs={class:"input"},$s={class:"attrs-item"},Ds=t("div",{class:"label"},"起始节点",-1),xs={class:"input"},Ss={class:"attrs-item"},ws=t("div",{class:"label"},"结束节点",-1),bs={class:"input"},Es={class:"attrs-item"},Ns=t("div",{class:"label"},"长度",-1),As={class:"input"},Cs={class:"attrs-item"},Ls=t("div",{class:"label"},"粗糙系数",-1),Ts={class:"input"},Rs={class:"attrs-item"},Is=t("div",{class:"label"},"进水偏移",-1),Os={class:"input"},ks={class:"attrs-item"},Us=t("div",{class:"label"},"出水偏移",-1),Ms={class:"input"},Ps={class:"attrs-item"},Fs=t("div",{class:"label"},"初始流量",-1),Gs={class:"input"},Ws={class:"attrs-item"},Ys=t("div",{class:"label"},"最大流量",-1),js={class:"input"},Bs={class:"attrs-item"},Js=t("div",{class:"label"},"标签",-1),Xs={class:"input"},Hs={class:"attrs-item"},Ks=t("div",{class:"label"},"进口损失系数",-1),qs={class:"input"},zs={class:"attrs-item"},Qs=t("div",{class:"label"},"出口损失系数",-1),Zs={class:"input"},ea={class:"attrs-item"},ta=t("div",{class:"label"},"平均损失系数",-1),sa={class:"input"},aa={class:"attrs-item"},la=t("div",{class:"label"},"拍门",-1),oa={class:"input"},na={class:"attrs-item"},ia=t("div",{class:"label"},"渗漏损失系数",-1),da={class:"input"},ra={class:"attrs-item"},ua=t("div",{class:"label"},"描述",-1),ca={class:"input"},pa=t("div",{class:"attrs-title"},"横断面配置",-1),ma={class:"attrs-item"},_a=t("div",{class:"label"},"形状",-1),ha={class:"input"},fa={class:"attrs-item"},va=t("div",{class:"label"},"筒数",-1),ga={class:"input"},ya={class:"attrs-item"},Va=t("div",{class:"label"},"最大深度",-1),$a={class:"input"},Da={key:0},xa={class:"attrs-item"},Sa=t("div",{class:"label"},"底宽",-1),wa={class:"input"},ba={class:"attrs-item"},Ea=t("div",{class:"label"},"删除边壁",-1),Na={class:"input"},Aa={class:"attrs-item"},Ca=t("div",{class:"label"},"[Geom4]",-1),La={class:"input"},Ta=ae({__name:"lineAttrs",props:{details:{type:Object,required:!0}},emits:["update:details","change"],setup(I,{emit:e}){const $=I,n=le({wallOptions:[{label:"无",value:0},{label:"左侧",value:1},{label:"右侧",value:2}],shapeType:[{label:"矩形",value:"RECT_OPEN"},{label:"圆形",value:"CIRCULAR"}]}),s=Ce({get:()=>$.details,set:R=>{e("update:details",R)}}),f=()=>{e("change")};return(R,l)=>{const D=b("el-input"),V=b("el-option"),x=b("el-select");return A(),M("div",hs,[t("div",fs,[vs,t("div",gs,[ys,t("div",Vs,[o(D,{modelValue:a(s).title,"onUpdate:modelValue":l[0]||(l[0]=i=>a(s).title=i),disabled:"",style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",$s,[Ds,t("div",xs,[o(D,{modelValue:a(s).sourceTitle,"onUpdate:modelValue":l[1]||(l[1]=i=>a(s).sourceTitle=i),disabled:"",style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",Ss,[ws,t("div",bs,[o(D,{modelValue:a(s).targetTitle,"onUpdate:modelValue":l[2]||(l[2]=i=>a(s).targetTitle=i),disabled:"",style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",Es,[Ns,t("div",As,[o(D,{modelValue:a(s).length,"onUpdate:modelValue":l[3]||(l[3]=i=>a(s).length=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",Cs,[Ls,t("div",Ts,[o(D,{modelValue:a(s).roughness,"onUpdate:modelValue":l[4]||(l[4]=i=>a(s).roughness=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",Rs,[Is,t("div",Os,[o(D,{modelValue:a(s).inOffset,"onUpdate:modelValue":l[5]||(l[5]=i=>a(s).inOffset=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",ks,[Us,t("div",Ms,[o(D,{modelValue:a(s).outOffset,"onUpdate:modelValue":l[6]||(l[6]=i=>a(s).outOffset=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",Ps,[Fs,t("div",Gs,[o(D,{modelValue:a(s).initFlow,"onUpdate:modelValue":l[7]||(l[7]=i=>a(s).initFlow=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",Ws,[Ys,t("div",js,[o(D,{modelValue:a(s).maxFlow,"onUpdate:modelValue":l[8]||(l[8]=i=>a(s).maxFlow=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",Bs,[Js,t("div",Xs,[o(D,{modelValue:a(s).tag,"onUpdate:modelValue":l[9]||(l[9]=i=>a(s).tag=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",Hs,[Ks,t("div",qs,[o(D,{modelValue:a(s).kentry,"onUpdate:modelValue":l[10]||(l[10]=i=>a(s).kentry=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",zs,[Qs,t("div",Zs,[o(D,{modelValue:a(s).kexit,"onUpdate:modelValue":l[11]||(l[11]=i=>a(s).kexit=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",ea,[ta,t("div",sa,[o(D,{modelValue:a(s).kavg,"onUpdate:modelValue":l[12]||(l[12]=i=>a(s).kavg=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",aa,[la,t("div",oa,[o(D,{modelValue:a(s).flapGate,"onUpdate:modelValue":l[13]||(l[13]=i=>a(s).flapGate=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",na,[ia,t("div",da,[o(D,{modelValue:a(s).seepage,"onUpdate:modelValue":l[14]||(l[14]=i=>a(s).seepage=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",ra,[ua,t("div",ca,[o(D,{modelValue:a(s).description,"onUpdate:modelValue":l[15]||(l[15]=i=>a(s).description=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),pa,t("div",ma,[_a,t("div",ha,[o(x,{modelValue:a(s).shapeData.shape,"onUpdate:modelValue":l[16]||(l[16]=i=>a(s).shapeData.shape=i),placeholder:"Select",style:{width:"150px"}},{default:y(()=>[(A(!0),M(te,null,se(n.shapeType,i=>(A(),j(V,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),t("div",fa,[va,t("div",ga,[o(D,{modelValue:a(s).shapeData.barrels,"onUpdate:modelValue":l[17]||(l[17]=i=>a(s).shapeData.barrels=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",ya,[Va,t("div",$a,[o(D,{modelValue:a(s).shapeData.geom1,"onUpdate:modelValue":l[18]||(l[18]=i=>a(s).shapeData.geom1=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),a(s).shapeData.shape!=="CIRCULAR"?(A(),M("span",Da,[t("div",xa,[Sa,t("div",wa,[o(D,{modelValue:a(s).shapeData.geom2,"onUpdate:modelValue":l[19]||(l[19]=i=>a(s).shapeData.geom2=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])]),t("div",ba,[Ea,t("div",Na,[o(x,{modelValue:a(s).shapeData.geom3,"onUpdate:modelValue":l[20]||(l[20]=i=>a(s).shapeData.geom3=i),placeholder:"Select",style:{width:"150px"},onChange:f},{default:y(()=>[(A(!0),M(te,null,se(n.wallOptions,i=>(A(),j(V,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),t("div",Aa,[Ca,t("div",La,[o(D,{modelValue:a(s).shapeData.geom4,"onUpdate:modelValue":l[21]||(l[21]=i=>a(s).shapeData.geom4=i),style:{width:"150px"},onChange:f},null,8,["modelValue"])])])])):re("",!0)])])}}});const Ra={class:"attrs"},Ia={class:"attrs-content"},Oa=t("div",{class:"attrs-title"},"基本配置",-1),ka={class:"attrs-item"},Ua=t("div",{class:"label"},"名称",-1),Ma={class:"input"},Pa={class:"attrs-item"},Fa=t("div",{class:"label"},"标签",-1),Ga={class:"input"},Wa={class:"attrs-item"},Ya=t("div",{class:"label"},"X",-1),ja={class:"input"},Ba={class:"attrs-item"},Ja=t("div",{class:"label"},"Y",-1),Xa={class:"input"},Ha={class:"attrs-item"},Ka=t("div",{class:"label"},"内底标高",-1),qa={class:"input"},za={class:"attrs-item"},Qa=t("div",{class:"label"},"进流量",-1),Za={class:"input"},el={class:"attrs-item"},tl=t("div",{class:"label"},"时间序列",-1),sl={class:"input"},al=t("i",{class:"iconfont icon-gengduo"},null,-1),ll=[al],ol={class:"attrs-item"},nl=t("div",{class:"label"},"曲线名",-1),il={class:"input"},dl=t("i",{class:"iconfont icon-gengduo"},null,-1),rl=[dl],ul={class:"attrs-item"},cl=t("div",{class:"label"},"类型",-1),pl={class:"input"},ml={class:"attrs-item"},_l=t("div",{class:"label"},"描述",-1),hl={class:"input"},fl=ae({__name:"triangleAttrs",props:{details:{type:Object,required:!0}},emits:["update:details","change"],setup(I,{emit:e}){const $=I,n=le({timeSeriesDiaVis:!1,patternDiaVis:!1,triangleType:[{label:"FREE",value:"FREE"},{label:"NORMAL",value:"NORMAL"},{label:"FIXED",value:"FIXED"},{label:"TIDAL",value:"TIDAL"},{label:"TIMESERIES",value:"TIMESERIES"}]}),s=Ce({get:()=>$.details,set:C=>{e("update:details",C)}});ue(()=>{s.value.timeSeriesData.name!==""?s.value.inflows="YES":s.value.inflows="NO"});const f=C=>{s.value.timeSeriesData=C,l(),V()},R=C=>{s.value.patternData=C,l(),i()},l=()=>{e("change")},D=()=>{n.timeSeriesDiaVis=!0},V=()=>{n.timeSeriesDiaVis=!1},x=()=>{n.patternDiaVis=!0},i=()=>{n.patternDiaVis=!1};return(C,p)=>{const S=b("el-input"),P=b("el-input-number"),v=b("el-option"),X=b("el-select");return A(),M("div",Ra,[t("div",Ia,[Oa,t("div",ka,[Ua,t("div",Ma,[o(S,{modelValue:a(s).title,"onUpdate:modelValue":p[0]||(p[0]=E=>a(s).title=E),disabled:"",style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",Pa,[Fa,t("div",Ga,[o(S,{modelValue:a(s).tag,"onUpdate:modelValue":p[1]||(p[1]=E=>a(s).tag=E),style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",Wa,[Ya,t("div",ja,[o(P,{modelValue:a(s).x,"onUpdate:modelValue":p[2]||(p[2]=E=>a(s).x=E),controls:!1,onChange:l},null,8,["modelValue"])])]),t("div",Ba,[Ja,t("div",Xa,[o(P,{modelValue:a(s).y,"onUpdate:modelValue":p[3]||(p[3]=E=>a(s).y=E),controls:!1,onChange:l},null,8,["modelValue"])])]),t("div",Ha,[Ka,t("div",qa,[o(S,{modelValue:a(s).elevation,"onUpdate:modelValue":p[4]||(p[4]=E=>a(s).elevation=E),style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",za,[Qa,t("div",Za,[o(S,{modelValue:a(s).inflows,"onUpdate:modelValue":p[5]||(p[5]=E=>a(s).inflows=E),disabled:"",style:{width:"150px"},onChange:l},null,8,["modelValue"])])]),t("div",el,[tl,t("div",sl,[o(S,{modelValue:a(s).timeSeriesData.name,"onUpdate:modelValue":p[6]||(p[6]=E=>a(s).timeSeriesData.name=E),disabled:"",style:{width:"150px"},onChange:l},null,8,["modelValue"])]),t("div",{class:"btn",onClick:D},ll)]),t("div",ol,[nl,t("div",il,[o(S,{modelValue:a(s).patternData.name,"onUpdate:modelValue":p[7]||(p[7]=E=>a(s).patternData.name=E),disabled:"",style:{width:"150px"},onChange:l},null,8,["modelValue"])]),t("div",{class:"btn",onClick:x},rl)]),t("div",ul,[cl,t("div",pl,[o(X,{modelValue:a(s).typ,"onUpdate:modelValue":p[8]||(p[8]=E=>a(s).typ=E),placeholder:"Select",style:{width:"150px"},onChange:l},{default:y(()=>[(A(!0),M(te,null,se(n.triangleType,E=>(A(),j(v,{key:E.value,label:E.label,value:E.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),t("div",ml,[_l,t("div",hl,[o(S,{modelValue:a(s).description,"onUpdate:modelValue":p[9]||(p[9]=E=>a(s).description=E),style:{width:"150px"},onChange:l},null,8,["modelValue"])])])]),n.timeSeriesDiaVis?(A(),j(Te,{key:0,details:a(s).timeSeriesData,onClose:V,onSave:f},null,8,["details"])):re("",!0),n.patternDiaVis?(A(),j(Re,{key:1,details:a(s).patternData,onClose:i,onSave:R},null,8,["details"])):re("",!0)])}}});const vl={class:"advanced"},gl={class:"header"},yl=t("div",{class:"action-left"},null,-1),Vl={class:"action-right"},$l={class:"container"},Dl={class:"address"},xl={class:"shapes"},Sl=t("div",{class:"shapes-title"},"功能栏",-1),wl={class:"shapes-content"},bl=["onMousedown"],El=t("div",{id:"canvas",style:{background:"#ffff"}},null,-1),Nl={key:3,class:"attrs"},Al=t("div",{class:"attrs-content"},[t("div",{class:"attrs-title"},"基本配置")],-1),Cl=[Al],Ll={class:"contextMenu"},Tl=["onClick"],Ol=ae({__name:"index",setup(I){const e=le({konva:new Ke("canvas"),type:"normal",shapeAttrs:{},menuList:[{name:"删除",type:"destroy",disabled:!1}],address:{x:0,y:0},startNode:void 0,endNode:void 0,lineNode:void 0,nodeEdges:[],contextMenuVis:!1,a:1732753786166,b:1732796973886});Ge(),ue(()=>{n(),document.oncontextmenu=function(){return!1}});const $=()=>Date.now()>e.a||Date.now()<e.b,n=()=>{$()||(e.konva.init(),R(),s(),window.onresize=()=>{e.konva.onresize()})},s=()=>{const m=localStorage.getItem("shapes");if(m){let _=JSON.parse(m);f(_)}const d=localStorage.getItem("edges");d&&(e.nodeEdges=JSON.parse(d))},f=m=>{const{group:d}=e.konva;m.forEach(_=>{if(_.type===r.LINE){let h=e.konva.newLine(_);d.add(h),h.moveToBottom(),l(h)}else if(_.type===r.CIRCLE){let h=e.konva.newCircle(_);d.add(h),h.moveToTop(),l(h)}else if(_.type===r.TRIANGLE){let h=e.konva.newRegularPolygon(_);d.add(h),h.moveToTop(),l(h)}}),x(!0)},R=()=>{const{stage:m,tr:d}=e.konva;m&&(m.container(),m.on("click tap",_=>{const h=_.target,g=h.getAttrs();let N=0,L=2;if(e.type===r.NORMAL){if(_.evt.button===N){v();return}if(_.evt.button===L){if(g.type!==r.LINE&&g.type!==r.CIRCLE&&g.type!==r.TRIANGLE)return;if(i(h),v(),!e.contextMenuVis){P();let w=document.querySelector(".contextMenu");if(!w)return;w.style.left=`${_.evt.clientX+10}px`,w.style.top=`${_.evt.clientY+1}px`}}return}if(e.type!==r.NORMAL){if(e.type!==r.LINE){if(e.type===r.CIRCLE){if(_.evt.button===N){const{x:w,y:U}=m.getRelativePointerPosition(),O=e.konva.drawShapes(e.type,{x:w,y:U});if(!O)return;O.setAttrs({elevation:"0",maxDepth:"0",initDepth:"0",surDepth:"0",aponded:"0",description:"",tag:"",inflows:"NO",constituent:"FLOW",timeSeriesData:{name:"",description:"",datas:[]},typ:"FLOW",mfactor:"1.0",sfactor:"1.0",baseline:"1.0",patternData:{name:"",description:"",type:"month",datas:[]}}),l(O)}}else if(e.type===r.TRIANGLE&&_.evt.button===N){const{x:w,y:U}=m.getRelativePointerPosition(),O=e.konva.drawShapes(e.type,{x:w,y:U});if(!O)return;O.setAttrs({description:"",tag:"",inflows:"NO",elevation:"",gated:"NO",typ:"FREE",fixed:"",stageData:"",xlName:"",timeSeriesData:{name:"",description:"",datas:[]},patternData:{name:"",description:"",type:"month",datas:[]}}),l(O)}}}}),m.on("mousedown",_=>{const h=_.target,g=h.getAttrs();console.log(g);let N=0,L=1;if(e.type===r.NORMAL)_.evt.button===N&&(i(h),g.type===r.CANVAS?V():(g.type,r.CIRCLE));else if(e.type===r.LINE){if(g.type===r.CIRCLE||g.type===r.TRIANGLE){e.startNode=h;const{x:w,y:U}=m.getRelativePointerPosition();e.lineNode=e.konva.drawLine(g.x,g.y,w,U)}}else e.type,r.CIRCLE;_.evt.button===L&&m.draggable(!0)}),m.on("mouseup",_=>{var L,w,U,O,G;_.target.getAttrs();let g=0,N=1;if(_.evt.button===N&&m.draggable(!1),e.type===r.NORMAL)_.evt.button;else if(e.type===r.LINE){if(!e.startNode)return;if(!e.lineNode){(L=e.startNode)==null||L.setAttrs({fill:"#000000"}),e.startNode=void 0;return}if(!e.endNode){(w=e.startNode)==null||w.setAttrs({fill:"#000000"}),(U=e.lineNode)==null||U.destroy(),e.startNode=void 0,e.lineNode=void 0;return}const B=e.startNode.getAttrs(),c=e.endNode.getAttrs();e.nodeEdges.push({id:e.lineNode.id(),source:B.id,target:c.id}),e.lineNode.setAttrs({points:[e.startNode.x(),e.startNode.y(),e.endNode.x(),e.endNode.y()],source:B.id,target:c.id,sourceTitle:B.title,targetTitle:c.title,length:"0",roughness:"0.01",inOffset:"0",outOffset:"0",initFlow:"0",maxFlow:"0",description:"",tag:"",kentry:"0",kexit:"0",kavg:"0",flapGate:"No",seepage:"0",shapeData:{shape:"CIRCULAR",geom1:"0",geom2:"0",geom3:"无",geom4:"0",barrels:"0"}}),(O=e.startNode)==null||O.setAttrs({fill:"#000000"}),(G=e.endNode)==null||G.setAttrs({fill:"#000000"}),e.startNode=void 0,e.endNode=void 0,e.lineNode=void 0}else e.type,r.CIRCLE}),m.on("mousemove",_=>{var w;const h=_.target,g=h.getAttrs(),{x:N,y:L}=m.getRelativePointerPosition();if(e.address={x:Math.round(N),y:Math.round(L)},e.type!==r.NORMAL)if(e.type===r.LINE){if(!e.startNode||!e.lineNode)return;g.type===r.CIRCLE||g.type===r.TRIANGLE?(e.endNode=h,e.endNode.setAttrs({fill:"#6da4f8"})):((w=e.endNode)==null||w.setAttrs({fill:"#000000"}),e.endNode=void 0),e.lineNode.points([e.startNode.x(),e.startNode.y(),N,L])}else e.type,r.CIRCLE}))},l=m=>{m.on("dragmove",d=>{i(d.target)}),m.on("transform",d=>{i(d.target)})},D=m=>{e.type=m,e.type===r.NORMAL?x(!0):e.type===r.LINE?(e.shapeAttrs={},x(!1)):(e.type===r.CIRCLE||e.type===r.TRIANGLE)&&(e.shapeAttrs={},x(!1)),V()},V=()=>{const{tr:m}=e.konva;m.nodes().forEach(d=>{d.getAttrs().type===r.CIRCLE&&d.draggable(!1)}),m.nodes([])},x=m=>{const{stage:d}=e.konva;if(!d)return;d.find(`.${r.CIRCLE}`).forEach(g=>{g.getAttrs().type===r.CIRCLE&&g.draggable(m)}),d.find(`.${r.TRIANGLE}`).forEach(g=>{g.getAttrs().type===r.TRIANGLE&&g.draggable(m)})},i=m=>{let d=S(m.getAttrs());d.x=Math.round(d.x),d.y=Math.round(d.y),e.shapeAttrs=d,e.type===r.NORMAL&&(d.type===r.CIRCLE||d.type===r.TRIANGLE)&&C(d.id)},C=m=>{e.nodeEdges.forEach(d=>{var N,L,w;const _=(N=e.konva.stage)==null?void 0:N.findOne(`#${d.source}`),h=(L=e.konva.stage)==null?void 0:L.findOne(`#${d.target}`),g=(w=e.konva.stage)==null?void 0:w.findOne(`#${d.id}`);_&&h&&g&&(d.source===m&&g.setAttrs({points:[_.x(),_.y(),h.x(),h.y()]}),d.target===m&&g.setAttrs({points:[h.x(),h.y(),_.x(),_.y()]}))})},p=()=>{const{stage:m}=e.konva;if(!m)return;const d=m.findOne(`#${e.shapeAttrs.id}`);if(d)if(e.shapeAttrs.type===r.CIRCLE||e.shapeAttrs.type===r.TRIANGLE){if(!e.shapeAttrs.x||!e.shapeAttrs.y)return;d.setAttrs(S(e.shapeAttrs)),C(e.shapeAttrs.id)}else e.shapeAttrs.type===r.LINE&&(d.setAttrs(S(e.shapeAttrs)),C(e.shapeAttrs.id))},S=m=>{if(m.type===r.CIRCLE){const{id:z,x:Q,y:Z,title:ee,type:pe,elevation:me,maxDepth:_e,initDepth:he,surDepth:fe,aponded:ve,description:ge,tag:ye,inflows:Ve,constituent:$e,timeSeriesData:De,typ:xe,mfactor:Se,sfactor:we,baseline:be,patternData:Ee}=m;return{id:z,x:Q,y:Z,title:ee,type:pe,elevation:me,maxDepth:_e,initDepth:he,surDepth:fe,aponded:ve,description:ge,tag:ye,inflows:Ve,constituent:$e,timeSeriesData:De,typ:xe,mfactor:Se,sfactor:we,baseline:be,patternData:Ee}}else if(m.type===r.LINE){let{id:z,title:Q,type:Z,source:ee,sourceTitle:pe,targetTitle:me,target:_e,length:he,roughness:fe,inOffset:ve,outOffset:ge,initFlow:ye,maxFlow:Ve,description:$e,tag:De,kentry:xe,kexit:Se,lexit:we,kavg:be,flapGate:Ee,seepage:Ue,shapeData:Me}=m;return{id:z,title:Q,type:Z,source:ee,sourceTitle:pe,targetTitle:me,target:_e,length:he,roughness:fe,inOffset:ve,outOffset:ge,initFlow:ye,maxFlow:Ve,description:$e,tag:De,kentry:xe,kexit:Se,lexit:we,kavg:be,flapGate:Ee,seepage:Ue,shapeData:Me}}let{id:d,x:_,y:h,title:g,type:N,typ:L,description:w,tag:U,inflows:O,elevation:G,gated:B,fixed:c,stageData:F,xlName:W,timeSeriesData:Le,patternData:de}=m;return{id:d,x:_,y:h,title:g,type:N,typ:L,description:w,tag:U,inflows:O,elevation:G,gated:B,fixed:c,stageData:F,xlName:W,timeSeriesData:Le,patternData:de}},P=()=>{e.contextMenuVis=!0},v=()=>{e.contextMenuVis=!1},X=m=>{var g;const{shapeAttrs:d,konva:_}=e,h=(g=_.stage)==null?void 0:g.findOne(`#${d.id}`);if(h){if(m==="moveUp")h.moveUp();else if(m==="moveDown"){if(h.getAbsoluteZIndex()===5)return;h.moveDown()}else m==="destroy"&&(d.type===r.CIRCLE?e.nodeEdges=e.nodeEdges.filter(N=>{var w;if(N.source!==d.id&&N.target!==d.id)return!0;const L=(w=_.stage)==null?void 0:w.findOne(`#${N.id}`);return L&&L.destroy(),!1}):d.type===r.LINE&&(e.nodeEdges=e.nodeEdges.filter(N=>{var w;if(N.id!==d.id)return!0;const L=(w=_.stage)==null?void 0:w.findOne(`#${N.id}`);return L&&L.destroy(),!1})),e.shapeAttrs={},h.destroy());_.tr.nodes([]),v()}},E=()=>{let m=e.konva.group.find("Shape"),d=[];m.forEach(_=>{d.push(_.getAttrs())}),localStorage.setItem("shapes",JSON.stringify(d)),localStorage.setItem("edges",JSON.stringify(e.nodeEdges))},oe=()=>{const m=ne(),d=new Blob([m],{type:"text/plain"}),_=URL.createObjectURL(d),h=document.createElement("a");h.href=_,h.download="example.inp",document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(_)},ne=()=>{let m=e.konva.group.find("Shape"),d=[];m.forEach(c=>{d.push(c.getAttrs())});let _=d.map(c=>{if(c.type===r.CIRCLE)return`${u(c.title)}${u(c.elevation)}${u(c.maxDepth)}${u(c.initDepth)}${u(c.surDepth)}${u(c.aponded)}`}).join(`
`).replace(new RegExp("(?<!\\S)\\r?\\n(?!\\S)","g"),""),h=d.map(c=>`${u("Node")}${u(c.title)}${u(c.tag)}`).join(`
`).replace(new RegExp("(?<!\\S)\\r?\\n(?!\\S)","g"),""),g=d.map(c=>{if(c.type===r.CIRCLE)return`${u(c.id)}${u(c.constituent)}${u(c.timeSeriesData.name)}${u(c.typ)}${u(c.mfactor)}${u(c.sfactor)}${u(c.baseline)}${u(c.patternData.name)}`}).join(`
`).replace(new RegExp("(?<!\\S)\\r?\\n(?!\\S)","g"),""),N=d.map(c=>{if(c.type===r.CIRCLE||c.type===r.TRIANGLE){let F="";return c.timeSeriesData.datas.forEach(W=>{F+=`${u(c.timeSeriesData.name)}${u(W.date)}${u(W.time)}${u(W.value)}
`}),F}}).join(`
`).replace(new RegExp("(?<!\\S)\\r?\\n(?!\\S)","g"),""),L=d.map(c=>{if(c.type===r.CIRCLE){let F="";return c.patternData.datas.forEach(W=>{F+=`${u(c.patternData.name)}${u(c.patternData.type)}${u(W.value)}
`}),F}}).join(`
`).replace(new RegExp("(?<!\\S)\\r?\\n(?!\\S)","g"),""),w=d.map(c=>{if(c.type===r.LINE){let F="fromNode",W="toNode";return e.nodeEdges.forEach(de=>{var z,Q;if(de.id===c.id){const Z=(z=e.konva.stage)==null?void 0:z.findOne(`#${de.source}`);Z&&(F=Z.getAttrs().title);const ee=(Q=e.konva.stage)==null?void 0:Q.findOne(`#${de.target}`);ee&&(W=ee.getAttrs().title)}}),`${u(c.title)}${u(F)}${u(W)}${u(c.length)}${u(c.roughness)}${u(c.inOffset)}${u(c.outOffset)}${u(c.initFlow)}${u(c.maxFlow)}`}}).join(`
`).replace(new RegExp("(?<!\\S)\\r?\\n(?!\\S)","g"),""),U=d.map(c=>{if(c.type===r.LINE)return`${u(c.title)}${u(c.kentry)}${u(c.kexit)}${u(c.kavg)}${u(c.flapGate)}${u(c.seepage)}`}).join(`
`).replace(new RegExp("(?<!\\S)\\r?\\n(?!\\S)","g"),""),O=d.map(c=>{if(c.type===r.TRIANGLE)return`${u(c.title)}${u(c.elevation)}${u(c.stageData)}${u(c.gated)}`}).join(`
`).replace(new RegExp("(?<!\\S)\\r?\\n(?!\\S)","g"),""),G=d.map(c=>{if(c.type===r.TRIANGLE){let F="";return c.patternData.datas.forEach(W=>{F+=`${u(c.patternData.name)}${u(c.patternData.type)}${u(W.name)}${u(W.value)}
`}),F}}).join(`
`).replace(new RegExp("(?<!\\S)\\r?\\n(?!\\S)","g"),"");return`
[TITLE]
;;Project Title/Notes

[OPTIONS]
;;Option             Value
FLOW_UNITS           CFS
INFILTRATION         HORTON
FLOW_ROUTING         DYNWAVE
LINK_OFFSETS         DEPTH
MIN_SLOPE            0
ALLOW_PONDING        NO
SKIP_STEADY_STATE    NO

START_DATE           11/22/2024
START_TIME           00:00:00
REPORT_START_DATE    11/22/2024
REPORT_START_TIME    00:00:00
END_DATE             11/22/2024
END_TIME             06:00:00
SWEEP_START          1/1
SWEEP_END            12/31
DRY_DAYS             0
REPORT_STEP          00:15:00
WET_STEP             00:05:00
DRY_STEP             01:00:00
ROUTING_STEP         0:00:20 
RULE_STEP            00:00:00

INERTIAL_DAMPING     PARTIAL
NORMAL_FLOW_LIMITED  BOTH
FORCE_MAIN_EQUATION  H-W
VARIABLE_STEP        0.75
LENGTHENING_STEP     0
MIN_SURFAREA         0
MAX_TRIALS           0
HEAD_TOLERANCE       0
SYS_FLOW_TOL         5
LAT_FLOW_TOL         5
MINIMUM_STEP         0.5
THREADS              1

[EVAPORATION]
;;Data Source    Parameters
;;-------------- ----------------
CONSTANT         0.0
DRY_ONLY         NO

[JUNCTIONS]
;;Name           Elevation  MaxDepth   InitDepth  SurDepth   Aponded   
;;-------------- ---------- ---------- ---------- ---------- ----------
${_}

[TAGS]
;;Node       dian1            tag1   
;;-------------- ---------- ---------- ---------- ---------- ----------
${h}

[INFLOWS]
;;Node           Constituent      Time Series      Type     Mfactor  Sfactor  Baseline Pattern
;;-------------- ---------------- ---------------- -------- -------- -------- -------- --------
${g}

[TIMESERIES]
;;Name           Date       Time       Value     
;;-------------- ---------- ---------- ----------
${N}  

[PATTERNS]
;;Name           Type       Multipliers
;;-------------- ---------- -----------
${L}

[CONDUITS]
;;Name           From Node        To Node          Length     Roughness  InOffset   OutOffset  InitFlow   MaxFlow   
;;-------------- ---------------- ---------------- ---------- ---------- ---------- ---------- ---------- ----------
${w} 

[LOSSES]
;;Link           Kentry     Kexit      Kavg       Flap Gate  Seepage   
;;-------------- ---------- ---------- ---------- ---------- ----------
${U}


[OUTFALLS]
;;Name           Elevation   Type       StageData        Gated       
;;-------------- ---------- ---------- ---------------- -------- 
${O}

[CURVES]
;;Name           Type       X-Value    Y-Value   
;;-------------- ---------- ---------- ----------
${G}

[REPORT]
;;Reporting Options
SUBCATCHMENTS ALL
NODES ALL
LINKS ALL

[MAP]
DIMENSIONS 0.000 0.000 10000.000 10000.000
Units      None


;;
;;JSONNODE ${JSON.stringify(d)}
;;JSONEDGES ${JSON.stringify(e.nodeEdges)}
;;
`},u=(m,d=5,_=" ")=>(m=String(m),m.padEnd(m.length+d,_)),Y=async()=>{let m=e.konva.group.find("Shape");for(let d=0;d<m.length;d++){const _=m[d];_.getAttrs().type!==r.BOARD&&_.destroy()}e.nodeEdges=[],e.shapeAttrs={},localStorage.removeItem("shapes"),localStorage.removeItem("edges")},T=We(),ie=()=>{T.value.click()},Ie=async m=>{var _;await Y();const d=(_=m.target)==null?void 0:_.files[0];if(d){const h=new FileReader;h.onload=g=>{var O;const L=((O=g.target)==null?void 0:O.result).split(`
`).map(G=>G.trim()),w=";;JSONNODE",U=";;JSONEDGES";L.forEach(G=>{if(G.substring(0,w.length)===w){const B=JSON.parse(G.replace(w,""));f(B)}else if(G.substring(0,U.length)===U){const B=JSON.parse(G.replace(U,""));e.nodeEdges=B}}),E(),location.reload()},h.onerror=g=>{console.error("文件读取失败:",g)},h.readAsText(d)}},{shapeAttrs:q,menuList:Oe,contextMenuVis:ke}=Ae(e);return(m,d)=>{const _=b("el-button");return A(),M("div",vl,[t("div",gl,[yl,t("div",Vl,[o(_,{type:"success",onClick:E},{default:y(()=>[J("保存")]),_:1}),o(_,{type:"primary",onClick:oe},{default:y(()=>[J("导出")]),_:1}),o(_,{type:"primary",onClick:ie},{default:y(()=>[J("导入")]),_:1}),o(_,{type:"danger",onClick:Y},{default:y(()=>[J("清空")]),_:1}),t("input",{ref_key:"fileInputRef",ref:T,type:"file",style:{display:"none"},onChange:Ie},null,544)])]),t("div",$l,[t("div",Dl,"x,y:"+ce(e.address.x)+","+ce(e.address.y),1),t("div",xl,[Sl,t("div",wl,[(A(!0),M(te,null,se(a(Be),(h,g)=>(A(),M("div",{key:g,class:Ne(["shapes-item",h.type===e.type?"active":""]),onMousedown:N=>D(h.type)},[t("i",{class:Ne(["iconfont",h.icon])},null,2),t("label",null,ce(h.name),1)],42,bl))),128))])]),El,a(q).type===a(r).CIRCLE?(A(),j(_s,{key:0,details:a(q),onChange:p},null,8,["details"])):a(q).type===a(r).LINE?(A(),j(Ta,{key:1,details:a(q),onChange:p},null,8,["details"])):a(q).type===a(r).TRIANGLE?(A(),j(fl,{key:2,details:a(q),onChange:p},null,8,["details"])):(A(),M("div",Nl,Cl))]),Ye(t("div",Ll,[(A(!0),M(te,null,se(a(Oe),(h,g)=>(A(),M("div",{key:g,class:Ne(["contextmenu-item",h.disabled?"disabled":"default"]),onClick:N=>X(h.type)},ce(h.name),11,Tl))),128))],512),[[je,a(ke)]])])}}});export{Ol as default};
