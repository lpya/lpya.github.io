var K=Object.defineProperty;var Z=(L,t,c)=>t in L?K(L,t,{enumerable:!0,configurable:!0,writable:!0,value:c}):L[t]=c;var V=(L,t,c)=>(Z(L,typeof t!="symbol"?t+"":t,c),c);import{d as j,r as q,i as J,t as Q,c as U,a as e,e as _,w as N,F as I,b as X,u as r,g as O,k as tt,v as et,h as T,o as B,f as D,n as Y}from"./index-879ded5a.js";import{K as f}from"./_FullInternals-b1d87c82.js";const a={RECT:"rect",PARALLELOGRAM:"parallelogram",RHOMBUS:"rhombus",LINE:"line",ARROWS:"arrows",TEXT:"text",CIRCLEL:"circle",OVAL:"oval",ANNULAR:"annular",PENTAGON:"pentagon",HEXAGON:"hexagon",FIVESTAR:"fivestar",TRAPEZIUM:"trapezium",FAN:"fan",HEART:"heart",CANVAS:"canvas",BOARD:"board"},nt=[{name:"矩形",icon:"icon-juxing",type:a.RECT},{name:"平行四边形",icon:"icon-tx-pinghangsibianxing",type:a.PARALLELOGRAM},{name:"菱形",icon:"icon-tubiao",type:a.RHOMBUS},{name:"直线",icon:"icon-line",type:a.LINE},{name:"箭头",icon:"icon-xiaoyoujiantou",type:a.ARROWS},{name:"文本",icon:"icon-wenben",type:a.TEXT},{name:"圆形",icon:"icon-yuanxingweixuanzhong",type:a.CIRCLEL},{name:"椭圆",icon:"icon-tuoyuanxing",type:a.OVAL},{name:"环形",icon:"icon-huanxingtu",type:a.ANNULAR},{name:"五边形",icon:"icon-pentagon",type:a.PENTAGON},{name:"六边形",icon:"icon-tx-liubianxing",type:a.HEXAGON},{name:"五角星",icon:"icon-wujiaoxing",type:a.FIVESTAR},{name:"梯形",icon:"icon-tx-tixing",type:a.TRAPEZIUM},{name:"扇形",icon:"icon-shanxing",type:a.FAN},{name:"心形",icon:"icon-heart",type:a.HEART}];class st{constructor(t){V(this,"id");V(this,"SCALE_BY");V(this,"stage");V(this,"layer");V(this,"tr");V(this,"group");this.id=t,this.SCALE_BY=1.1,this.stage=null,this.layer=this.newLayer(),this.tr=this.newTransformer(),this.group=this.newGroup({x:0,y:0}),this.init()}init(){const t=document.getElementById(this.id);if(!t)return;const{clientWidth:c,clientHeight:d}=t;this.stage=this.newStage({container:this.id,width:c,height:d,draggable:!1,type:a.CANVAS}),this.layer.add(this.group),this.layer.add(this.tr),this.stage.add(this.layer),this.drawBoard(),this.addListenerStageEvents()}addListenerStageEvents(){const{stage:t}=this;t&&t.on("wheel",c=>{if(!t)return;const d=t.scaleX(),p=t.getPointerPosition(),m={x:(p.x-t.x())/d,y:(p.y-t.y())/d};let y=c.evt.deltaY>0?-1:1;c.evt.ctrlKey&&(y=-y);const C=y>0?d*this.SCALE_BY:d/this.SCALE_BY;t.scale({x:C,y:C});const v={x:p.x-m.x*C,y:p.y-m.y*C};t.position(v)})}drawBoard(){if(!this.stage)return;const t=800,c=500,d=this.stage.width()/2-t/2,p=this.stage.height()/2-c/2,m=this.newRect({id:this.getUUID(),title:"画板",name:"board",x:d,y:p,width:t,height:c,fill:"#ffffff",type:a.BOARD,stroke:"#ffffff",strokeWidth:1,opacity:1,create:!0,scaleX:1,scaleY:1});this.group.add(m)}drawShapes(t,c){if(!this.stage)return;let d;const p=this.getUUID();if(t===a.RECT){const m=this.stage.find(".rect");d=this.newRect({id:p,title:`矩形${m.length+1}`,name:"rect",width:200,height:100,fill:"#ffffff",stroke:"#000000",strokeWidth:1,draggable:!0,type:t,opacity:1,create:!0,scaleX:1,scaleY:1})}else if(t===a.PARALLELOGRAM){const m=this.stage.find(".parallelogram");d=this.newRect({id:p,title:`平行四边形${m.length+1}`,name:"parallelogram",width:200,height:100,fill:"#ffffff",stroke:"#000000",strokeWidth:1,draggable:!0,skewX:-.5,type:t,opacity:1,create:!0,scaleX:1,scaleY:1})}else if(t===a.RHOMBUS){const m=this.stage.find(".rhombus");d=new f.RegularPolygon({id:p,title:`菱形${m.length+1}`,sides:4,radius:100,name:"rhombus",fill:"#ffffff",stroke:"#000000",strokeWidth:1,draggable:!0,type:t,opacity:1,create:!0,scaleX:1,scaleY:1})}if(d)return d.position(c),this.group.add(d),d}onresize(){var p;const t=document.getElementById(this.id);if(!t)return;const{clientWidth:c,clientHeight:d}=t;(p=this.stage)==null||p.setAttrs({width:c,height:d})}getUUID(){let t=Date.now();return typeof performance<"u"&&typeof performance.now=="function"&&(t+=performance.now()),"xxxxxxxxxxxxxxx4xxxyxxxxxxxxxxxxxx".replace(/[xy]/g,function(c){const d=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(c==="x"?d:d&3|8).toString(16)})}newStage(t){return new f.Stage(t)}newLayer(){return new f.Layer}newTransformer(){return new f.Transformer}newGroup(t){return new f.Group(t)}newRect(t){return new f.Rect(t)}newCircle(t){return new f.Circle(t)}newText(t){return new f.Text(t)}newRegularPolygon(t){return new f.RegularPolygon(t)}newLine(t){return new f.Line(t)}newLabel(t){return new f.Label(t)}newTag(t){return new f.Tag(t)}newArrows(t){return new f.Arrow(t)}newPath(t){return new f.Path(t)}}const ot={class:"advanced"},it={class:"header"},at={class:"action-left"},lt={class:"action-right"},rt={class:"container"},dt={class:"shapes"},ct=e("div",{class:"shapes-title"},"基本图形",-1),ut={class:"shapes-content"},ht=["onMousedown"],pt=e("div",{id:"canvas"},null,-1),ft={class:"attrs"},mt={class:"attrs-content"},gt=e("div",{class:"attrs-title"},"属性",-1),_t={class:"attrs-item"},vt=e("div",{class:"label"},"标题",-1),xt={class:"input"},yt={class:"attrs-item"},wt=e("div",{class:"label"},"宽",-1),At={class:"input"},bt={class:"attrs-item"},Rt=e("div",{class:"label"},"高",-1),Lt={class:"input"},kt={class:"attrs-item"},St=e("div",{class:"label"},"X",-1),Vt={class:"input"},Ct={class:"attrs-item"},Et=e("div",{class:"label"},"Y",-1),Mt={class:"input"},Ut=e("div",{class:"attrs-title"},"外形",-1),Ot={class:"attrs-item"},Tt=e("div",{class:"label"},"不透明度",-1),Bt={class:"input"},Pt={class:"color"},Nt={class:"attrs-item"},Dt=e("div",{class:"label"},"填充",-1),It={class:"input"},Xt={class:"color"},Yt={class:"attrs-item"},Ht=e("div",{class:"label"},"边框",-1),Wt={class:"input"},Gt={class:"color"},$t={class:"attrs-item"},zt=e("div",{class:"label"},"边框宽度",-1),Ft={class:"input"},Kt={class:"contextMenu"},Zt=["onClick"],Qt=j({__name:"index",setup(L){const t=q({konva:new st("canvas"),type:"",shapeAttrs:{},menuList:[{name:"上移图形",type:"moveUp",disabled:!1},{name:"下移图形",type:"moveDown",disabled:!1},{name:"删除",type:"destroy",disabled:!1}],contextMenuVis:!1});J(()=>{c(),document.oncontextmenu=function(){return!1}});const c=()=>{t.konva.init(),d(),window.onresize=()=>{t.konva.onresize()}},d=()=>{const{stage:s}=t.konva;if(!s)return;const n=s.container();y(s.findOne(".board")),s.on("click tap",i=>{const l=i.target,h=l.getAttrs();if(i.evt.button===2){if(h.type!==a.RECT&&h.type!==a.PARALLELOGRAM&&h.type!==a.RHOMBUS)return;if(y(l),P(),!t.contextMenuVis){H();let w=document.querySelector(".contextMenu");if(!w)return;l.getAbsoluteZIndex()===5?t.menuList[1].disabled=!0:t.menuList[1].disabled=!1,w.style.left=`${i.evt.clientX+10}px`,w.style.top=`${i.evt.clientY+1}px`}}}),s.on("mousedown",i=>{const l=i.target,h=l.getAttrs();if(i.evt.button===1&&s.draggable(!0),i.evt.button===0){if(P(),h.type===a.CANVAS){y(s.findOne(".board")),t.konva.tr.nodes([]);return}if(!h.create)return;if(y(l),h.type===a.BOARD){t.konva.tr.nodes([]);return}t.konva.tr.nodes([l])}}),s.on("mouseup",i=>{i.evt.button===1&&s.draggable(!1)}),n.addEventListener("dragover",i=>{i.preventDefault()}),n.addEventListener("drop",i=>{if(i.preventDefault(),t.type==="")return;s.setPointersPositions(i);const l=t.konva.drawShapes(t.type,s.getRelativePointerPosition());l&&p(l)})},p=s=>{s.on("dragmove",n=>{y(n.target)}),s.on("transform",n=>{y(n.target)})},m=s=>{t.type=s},y=s=>{const{id:n,title:i,opacity:l,fill:h,stroke:w,strokeWidth:k,width:o,height:g,x:A,y:M,scaleX:E,scaleY:b,type:R,radius:S}=s.getAttrs();let x={id:n,title:i,opacity:l,fill:h,stroke:w,strokeWidth:k,width:o,height:g,x:A,y:M,scaleX:E,scaleY:b,type:R,radius:S};R===a.RHOMBUS?(x.width=Math.round(S*E)*2,x.height=Math.round(S*b)*2):(x.width=Math.round(o*E),x.height=Math.round(g*b)),x.x=Math.round(A),x.y=Math.round(M),t.shapeAttrs=x},C=s=>s?Math.round(s*100):100,v=()=>{const{stage:s}=t.konva;if(!s)return;const n=s.findOne(`#${t.shapeAttrs.id}`);if(!n)return;let{id:i,title:l,opacity:h,fill:w,stroke:k,strokeWidth:o,width:g,height:A,x:M,y:E,scaleX:b,scaleY:R,type:S,radius:x}=t.shapeAttrs;g&&A&&b&&R&&(S===a.RHOMBUS?(b=g/x*.5,R=A/x*.5,n.setAttrs({id:i,title:l,opacity:h,fill:w,stroke:k,strokeWidth:o,x:M,y:E,scaleX:b,scaleY:R,type:S,radius:x})):(g=Math.round(g/b),A=Math.round(A/R),n.setAttrs({id:i,title:l,opacity:h,fill:w,stroke:k,strokeWidth:o,width:g,height:A,x:M,y:E,scaleX:b,scaleY:R,type:S})))},H=()=>{t.contextMenuVis=!0},P=()=>{t.contextMenuVis=!1},W=s=>{var h;const{shapeAttrs:n,konva:i}=t,l=(h=i.stage)==null?void 0:h.findOne(`#${n.id}`);if(l){if(s==="moveUp")l.moveUp();else if(s==="moveDown"){if(l.getAbsoluteZIndex()===5)return;l.moveDown()}else s==="destroy"&&l.destroy();i.tr.nodes([]),P()}},G=()=>{const s=t.konva.group.toDataURL();let n=document.createElement("a");n.download="canvas.png",n.href=s,document.body.appendChild(n),n.click(),document.body.removeChild(n)},$=()=>{let s=t.konva.group.find("Shape");for(let n=0;n<s.length;n++){const i=s[n];i.getAttrs().type!==a.BOARD&&i.destroy()}},{shapeAttrs:u,menuList:z,contextMenuVis:F}=Q(t);return(s,n)=>{const i=T("el-button"),l=T("el-input"),h=T("el-input-number"),w=T("el-slider"),k=T("el-color-picker");return B(),U("div",ot,[e("div",it,[e("div",at,[_(i,{type:"warning"},{default:N(()=>[D("返回")]),_:1})]),e("div",lt,[_(i,{type:"primary",onClick:G},{default:N(()=>[D("导出png")]),_:1}),_(i,{type:"danger",onClick:$},{default:N(()=>[D("清空")]),_:1})])]),e("div",rt,[e("div",dt,[ct,e("div",ut,[(B(!0),U(I,null,X(r(nt),(o,g)=>(B(),U("div",{key:g,class:"shapes-item",draggable:"true",onMousedown:A=>m(o.type)},[e("i",{class:Y(["iconfont",o.icon])},null,2),e("label",null,O(o.name),1)],40,ht))),128))])]),pt,e("div",ft,[e("div",mt,[gt,e("div",_t,[vt,e("div",xt,[_(l,{modelValue:r(u).title,"onUpdate:modelValue":n[0]||(n[0]=o=>r(u).title=o),style:{width:"150px"},onChange:v},null,8,["modelValue"])])]),e("div",yt,[wt,e("div",At,[_(h,{modelValue:r(u).width,"onUpdate:modelValue":n[1]||(n[1]=o=>r(u).width=o),controls:!1,onChange:v},null,8,["modelValue"])])]),e("div",bt,[Rt,e("div",Lt,[_(h,{modelValue:r(u).height,"onUpdate:modelValue":n[2]||(n[2]=o=>r(u).height=o),controls:!1,onChange:v},null,8,["modelValue"])])]),e("div",kt,[St,e("div",Vt,[_(h,{modelValue:r(u).x,"onUpdate:modelValue":n[3]||(n[3]=o=>r(u).x=o),controls:!1,onChange:v},null,8,["modelValue"])])]),e("div",Ct,[Et,e("div",Mt,[_(h,{modelValue:r(u).y,"onUpdate:modelValue":n[4]||(n[4]=o=>r(u).y=o),controls:!1,onChange:v},null,8,["modelValue"])])]),Ut,e("div",Ot,[Tt,e("div",Bt,[_(w,{modelValue:r(u).opacity,"onUpdate:modelValue":n[5]||(n[5]=o=>r(u).opacity=o),size:"small",min:0,max:1,step:.01,style:{width:"120px"},onChange:v},null,8,["modelValue","step"]),e("span",Pt,O(C(r(u).opacity))+"%",1)])]),e("div",Nt,[Dt,e("div",It,[_(k,{modelValue:r(u).fill,"onUpdate:modelValue":n[6]||(n[6]=o=>r(u).fill=o),onChange:v},null,8,["modelValue"]),e("span",Xt,O(r(u).fill),1)])]),e("div",Yt,[Ht,e("div",Wt,[_(k,{modelValue:r(u).stroke,"onUpdate:modelValue":n[7]||(n[7]=o=>r(u).stroke=o),onChange:v},null,8,["modelValue"]),e("span",Gt,O(r(u).stroke),1)])]),e("div",$t,[zt,e("div",Ft,[_(h,{modelValue:r(u).strokeWidth,"onUpdate:modelValue":n[8]||(n[8]=o=>r(u).strokeWidth=o),controls:!1,onChange:v},null,8,["modelValue"])])])])])]),tt(e("div",Kt,[(B(!0),U(I,null,X(r(z),(o,g)=>(B(),U("div",{key:g,class:Y(["contextmenu-item",o.disabled?"disabled":"default"]),onClick:A=>W(o.type)},O(o.name),11,Zt))),128))],512),[[et,r(F)]])])}}});export{Qt as default};
